
### Get genes under selection per nectar clade

TARGET=nectar
clades=$(echo "hmmbrds honeyeaters nectar_parrots sunbirds")

TARGET=nonnectar
clades=$(echo "swifts falcons lyrebirds passerides")

for i in $clades;
do
 grep ^$i under_selection_per_clade_0.05.$TARGET.tsv | cut -f2 > $i.under_selection_per_clade_0.05.txt;
done


### Enrichment analysis with ClusterProfiler
## Correction: with human ensembl genes!!

clades=$(echo hmmbrds honeyeaters nectar_parrots sunbirds falcons lyrebirds swifts passerides)
for i in $clades;
do 
 echo $i;
 renameToHLscaffolds.py -c 1 -a $i.under_selection_per_clade_0.05.txt -d <(sed 's/\t/,/' ../galGal6_gene.hg38_ens_gene.tsv) | grep ^ENSG  > hg38.$i.under_selection_per_clade_0.05.txt 
 goenrich_genelist.R -w $(pwd) -g hg38.$i.under_selection_per_clade_0.05.txt -o ClusterProfiler/hg38.goenrich.$i.under_selection_per_clade_0.05.tsv;
done



### Run enrichments for genes in diff ranks

TARGET=nectar
TARGET=nonnectar

## make gene lists
for i in {1..4}; do echo $i; cut -f2 under_selection_per_clade_0.05.$TARGET.tsv | sort | uniq -c | awk -v var=$i '$1>=var{print $2}' > rank${i}.$TARGET.genes_selection.lst; done

### Run enrichGO

## by clade

## by rank. Correction: with human ensembl genes!!
for t in nectar nonnectar; do for i in  {1..4}; do echo $i; goenrich_genelist.R -w $(pwd) -g hg38.rank${i}.$t.genes_selection.lst -o ClusterProfiler/hg38.goenrich.rank${i}.$t.
tsv; done; done

## by level
for i in $clades; do goenrich_genelist.R -w $(pwd) -g $i.under_selection_per_clade_0.05.txt -o ClusterProfiler/level3.goenrich.$i.under_selection_per_clade_0.05.tsv; done


### Enrichment analysis with metascape

md Metascape_enrich_4_lists/

# prepare lists for metascape
for i in $clades; do printf $i"\t"; cat $i.under_selection_per_clade_0.05.txt | tr '\n' ','; echo; done > Metascape_enrich_4_lists/for_metascape_4lists.under_selection_per_clade_0.05.$TARGET.txt

# run enrichment analysis: Min Overlap=2; P Value Cutoff=0.05; Min Enrichment=1.5; background genes = all genes.